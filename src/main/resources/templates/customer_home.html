<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Customer Home Page</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script th:inline="javascript">

        function validEmpty(string) {

            return string.trim().length > 0;
        }



        function handleName(event, target) {
            const inputEmail = event.target.value;

            if (!validEmpty(inputEmail)) {

                document.getElementById(target).className = "form-control is-invalid"
            }
            else {
                document.getElementById(target).className = "form-control is-valid"
            }

            //validateButton()
        }

        function handleSelect(event) {
            if (validEmpty(event.target.value)) {
                document.getElementById("gender").className = "form-select is-valid"
            }
            else {
                document.getElementById("gender").className = "form-select is-invalid"
            }
        }

        function handlePincode(event){
            const pinCode = event.target.value 

            if(Number.parseInt(pinCode) >= 100000 && Number.parseInt(pinCode) <= 999999){
                document.getElementById("pincode").className = "form-control is-valid"
            }
            else{
                document.getElementById("pincode").className = "form-control is-invalid"
            }
        }

        function updateProfile() {
            const gender = document.getElementById("gender").value

            const firstName = document.getElementById("firstName").value
            const lastName = document.getElementById("lastName").value

            const date = new Date(document.getElementById("dob").value)

            const id = document.getElementById("customerId").textContent

            const url = "http://localhost:8080/customer/update"

            const body = JSON.stringify({
                id,
                gender,
                name: {
                    firstName,
                    lastName
                },
                dateOfBirth: {
                    date: date.getDate(),
                    month: date.getMonth() + 1,
                    year: date.getFullYear()
                },
            })

            fetch(url, {
                method: 'POST',
                body: body,
                headers: {
                    'Content-Type': 'application/json'
                },
            }).then(async (res) => {
                if (res.ok) {
                    alert("Profile updated");
                    window.location.reload()
                }
                else {

                }
            })
                .catch((err) => {
                    console.log(err)
                })
        }

        function updateAddress() {
            const street = document.getElementById("street").value

            const landmark = document.getElementById("landmark").value

            const city = document.getElementById("city").value
            const state = document.getElementById("state").value
            const nation = document.getElementById("nation").value
            const pinCode = document.getElementById("pincode").value

            const url = "http://localhost:8080/customer/update/address"

            const body = JSON.stringify({
                pinCode,
                street,
                landmark,
                city,
                state,
                nation
            })

            fetch(url, {
                method: 'POST',
                body: body,
                headers: {
                    'Content-Type': 'application/json'
                },
            }).then(async (res) => {
                if (res.ok) {
                    alert("Address updated");
                    window.location.reload()
                }
                else {

                }
            })
                .catch((err) => {
                    console.log(err)
                })
        }




    </script>
    <div class="container-fluid">
        <nav class="navbar navbar-expand-lg bg-body-tertiary">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">My Home</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                    aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" aria-current="page" href="http://localhost:8080/home">
                                Home
                            </a>
                        </li>

                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false" th:if="${loginID}!= ''"
                                th:text="'Welcome, ' + ${customer.name.firstName} + ' ' + ${customer.name.lastName}">

                            </a>
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown"
                                aria-expanded="false" th:if="${loginID}== ''" th:text="'Welcome, Log In'">

                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" th:if="${loginID}!= ''" href="#">My Orders</a></li>
                                <li><a class="dropdown-item" th:if="${loginID}!= ''"
                                        href="http://localhost:8080/customer/mycart">My Cart</a></li>
                                <li>
                                    <hr th:if="${loginID}!= ''" class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" th:if="${loginID}!= ''" onclick="logOut()">Logout</a></li>
                                <li><a class="dropdown-item" th:if="${loginID} == ''" onclick="logIn()">Log In</a></li>

                            </ul>
                        </li>

                    </ul>
                    <div class="d-flex" role="">

                        <input class="form-control me-2" type="text" placeholder="Search" aria-label="Search"
                            id="query">
                        <button class="btn btn-outline-success" onclick="searchItem()">Search</button>
                    </div>
                </div>
            </div>
        </nav>
        <div class="row">
            <div class="col"></div>
            <div class="col text-center">
                <p class="display-6"></p>
            </div>
            <div class="col"></div>
        </div>
        <div class="row">

        </div>
        <div class="row">
            <div class="col-2"></div>
            <div class="col-8">

                <p hidden id="customerId" th:text="${loginID}"></p>
                <p class="display-6 text-center">My Profile</p>

                <table class="table table-striped">
                    <tbody>

                        <tr>
                            <th scope="row">Name</th>
                            <td>
                                <mark>
                                    <span th:text="${customer.name.firstName}">Harjinder</span>
                                    <span th:text="${customer.name.lastName}">Singh</span>
                                </mark>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">Gender</th>
                            <td style="color: green;" th:text="${customer.gender}">
                                Male
                            </td>

                        </tr>
                        <tr>
                            <th scope="row">Email</th>
                            <td th:text="${customer.email}">mail@ma.c</td>
                        </tr>
                        <tr>
                            <th scope="row">Current Age</th>
                            <td><span th:text="${age}">24</span> years</td>
                        </tr>
                        <tr>
                            <th scope="row">Member Since</th>
                            <td th:text="${membersince}"><span>26-01-2015</span></td>
                        </tr>

                    </tbody>
                </table>
            </div>
            <div class="col-4"></div>
        </div>

        <div class="row">
            <div class="col-5">

            </div>
            <div class="col-4">
                <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal"
                    data-bs-target="#staticBackdrop">
                    Edit Profile
                </button>

                <!-- Modal -->
                <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false"
                    tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="staticBackdropLabel">Edit Your Profile</h1>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="firstName" placeholder=""
                                                onchange="handleName(event, 'firstName')"
                                                th:value="${customer.name.firstName}">
                                            <label for="firstName">First Name</label>
                                            <div class="valid-feedback">
                                                Looks good!
                                            </div>
                                            <div class="invalid-feedback">
                                                First Name cannot be empty!
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col">
                                        <div class="form-floating mb-3">
                                            <input type="text" class="form-control" id="lastName" placeholder=""
                                                onchange="handleName(event, 'lastName')"
                                                th:value="${customer.name.lastName}">
                                            <label for="lastName">Last Name</label>
                                            <div class="valid-feedback">
                                                Looks good!
                                            </div>
                                            <div class="invalid-feedback">
                                                Last Name cannot be empty!
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-floating mb-3">
                                    <select class="form-select" aria-label="select" id="gender"
                                        onchange="handleSelect(event)">
                                        <option value="" selected>Select your gender</option>
                                        <option value="MALE">Male</option>
                                        <option value="FEMALE">Female</option>
                                        <option value="OTHER">Other</option>
                                    </select>
                                    <label for="gender">Gender</label>
                                    <div class="valid-feedback">
                                        Looks good!
                                    </div>
                                    <div class="invalid-feedback">
                                        Select a gender!
                                    </div>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="date" class="form-control" id="dob" th:value="${reversedoj}">
                                    <label for="dob">Date Of Birth</label>
                                    <div class="valid-feedback">
                                        Looks good!
                                    </div>
                                    <div class="invalid-feedback">
                                        You must be at least 18 years old!
                                    </div>
                                </div>

                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
                                <button type="button" class="btn btn-outline-success" onclick="updateProfile()">Update
                                    Profile</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-2">

            </div>
            <div class="col-8">
            <p class="display-6 mt-3 ">My Address</p>
            <div>
                <div class="input-group mb-3 w-100">
                    <span class="input-group-text" id="street_tag">Street</span>
                    <input type="text" class="form-control" placeholder="Street" aria-label="Street" aria-describedby="street_tag"
                    id = "street"
                    th:value="${customer.address.street}">
                    <span class="input-group-text" id="landmark_tag">Landmark</span>
                    <input type="text" class="form-control" placeholder="Landmark" aria-label="Landmark" aria-describedby="landmark_tag"
                    id = "landmark"
                    th:value="${customer.address.landmark}">
                  </div>

                  <div class="input-group mb-3">
                    
                    <span class="input-group-text" id="city_tag">City</span>
                    <input type="text" class="form-control" placeholder="City" aria-label="City" aria-describedby="city_tag"
                    id = "city"
                    th:value="${customer.address.city}">
                  </div>
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="state_tag">State</span>
                    <input type="text" class="form-control" placeholder="State" aria-label="State" aria-describedby="state_tag"
                    id = "state"
                    th:value="${customer.address.state}">
                    <span class="input-group-text" id="pincode_tag">Pincode</span>
                    <input type="number" class="form-control" placeholder="Pincode" aria-label="Pincode" aria-describedby="pincode_tag"
                    id = "pincode"
                    th:value="${customer.address.pinCode}"
                    onchange="handlePincode(event)">
                    <div class="valid-feedback">
                        Looks good!
                    </div>
                    <div class="invalid-feedback">
                        PINCODE must be a 6digit integer!
                    </div>
                  </div>
                  <div class="input-group mb-3">
                    <span class="input-group-text" id="nation_tag">Nation</span>
                    <input type="text" class="form-control" placeholder="Nation" aria-label="Nation" aria-describedby="nation_tag"
                    id = "nation"
                    th:value="${customer.address.nation}">
                    
                  </div>
            </div>
            
            </div>
            <div class="col-2">

            </div>
        </div>
        <div class="row">
            <div class="col-5"></div>
            <div class="col-4"><button class="btn btn-outline-info" onclick="updateAddress()">
                Update Address
            </button></div>
            <div class="col-4"></div>
            
        </div>
    </div>


</body>

</html>